<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spite Projects - AI projects built out of spite</title>
  <meta name="description" content="A directory of open-source projects built out of spite against over-commercialization and unnecessary complexity.">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header>
    <h1><a href="/">Spite Projects</a></h1>
  </header>

  <main>
    <p class="tagline" style="color: #888; margin-bottom: 1.5rem; font-style: italic;">
      Projects built out of spite against over-commercialization and unnecessary complexity
    </p>

    <div class="filters">
      <input type="search" class="search-box" id="search" placeholder="Search projects...">
    </div>

    <div class="projects" id="projects">
      <p style="color: #666;">Loading projects...</p>
    </div>

    <div class="submit-section">
      <h2>Submit Your Spite Project</h2>
      <p style="color: #aaa; line-height: 1.8;">
        Add your project to
        <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com/blob/main/data/listings.md" target="_blank">data/listings.md</a>
        and open a PR.<br>
        See the <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com/blob/main/DESIGN-METADATA.md" target="_blank">format guide</a> for details.
      </p>
      <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com/edit/main/data/listings.md"
         target="_blank"
         class="submit-button">
        Add Your Project via PR
      </a>
    </div>
  </main>

  <footer>
    <a href="/terms.html">Terms</a> · <a href="/privacy.html">Privacy</a> ·
    <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com" target="_blank">GitHub</a>
  </footer>

  <script>
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    function renderProject(p) {
      const links = [];
      if (p.repo) links.push(`<a href="${escapeHtml(p.repo)}" target="_blank" rel="noopener noreferrer">Repo</a>`);
      if (p.web) links.push(`<a href="${escapeHtml(p.web)}" target="_blank" rel="noopener noreferrer">Website</a>`);
      if (p.app?.android) links.push(`<a href="${escapeHtml(p.app.android)}" target="_blank" rel="noopener noreferrer">Android</a>`);
      if (p.app?.ios) links.push(`<a href="${escapeHtml(p.app.ios)}" target="_blank" rel="noopener noreferrer">iOS</a>`);

      const labels = (p.labels || []).slice(0, 3).map(l =>
        `<a href="/?label=${encodeURIComponent(l)}" class="label">${escapeHtml(l)}</a>`
      ).join('');

      const thumbHtml = p.thumbnail
        ? `<img src="${escapeHtml(p.thumbnail)}" alt="" class="project-thumb" loading="lazy">`
        : '';

      return `
        <div class="project-card ${p.thumbnail ? '' : 'no-thumb'}">
          ${thumbHtml}
          <div class="project-info">
            <h3>${escapeHtml(p.name)}</h3>
            <p class="description">${escapeHtml(p.description)}</p>
            <div class="project-meta">
              <span>by ${escapeHtml(p.author || 'anonymous')}</span>
            </div>
            <div class="labels">${labels}</div>
            <div class="project-links">${links.join('')}</div>
          </div>
        </div>
      `;
    }

    async function loadProjects() {
      const container = document.getElementById('projects');
      try {
        const res = await fetch('/api/projects');
        const projects = await res.json();

        if (projects.length === 0) {
          container.innerHTML = '<p style="color: #666;">No projects yet. Be the first to submit!</p>';
          return;
        }

        container.innerHTML = projects.map(renderProject).join('');
      } catch (err) {
        container.innerHTML = '<p style="color: #ff6b6b;">Failed to load projects</p>';
      }
    }

    // Search filter
    document.getElementById('search').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      document.querySelectorAll('.project-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(query) ? '' : 'none';
      });
    });

    loadProjects();
  </script>
</body>
</html>
