<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spite Projects - AI projects built out of spite</title>
  <meta name="description" content="A directory of open-source projects built out of spite against over-commercialization and unnecessary complexity.">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header>
    <h1><a href="/">Spite Projects</a></h1>
  </header>

  <main>
    <p class="tagline" style="color: #888; margin-bottom: 1.5rem; font-style: italic;">
      Projects built out of spite against over-commercialization and unnecessary complexity
    </p>

    <div class="filters">
      <input type="search" class="search-box" id="search" placeholder="Search projects...">
    </div>

    <div class="projects" id="projects">
      <p style="color: #666;">Loading projects...</p>
    </div>

    <div class="submit-section">
      <h2>Submit Your Spite Project</h2>
      <p style="color: #aaa; line-height: 1.8;">
        Add your project to
        <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com/blob/main/data/listings.md" target="_blank">data/listings.md</a>
        and open a PR.<br>
        See the <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com/blob/main/DESIGN-METADATA.md" target="_blank">format guide</a> for details.
      </p>
      <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com/edit/main/data/listings.md"
         target="_blank"
         class="submit-button">
        Add Your Project via PR
      </a>
    </div>
  </main>

  <footer>
    <a href="/">Projects</a> ¬∑ <a href="/builders.html">Builders</a> ¬∑ <a href="/manifesto.html">Manifesto</a> ¬∑
    <a href="/api.html">API Docs</a> ¬∑ <a href="/about.html">About</a> ¬∑ <a href="/badges.html">Badges</a> ¬∑ <a href="/terms.html">Terms</a> ¬∑ <a href="/privacy.html">Privacy</a> ¬∑
    <a href="https://github.com/Secret-Weapon-Group/spiteprojects-dot-com" target="_blank">GitHub</a>
    <br>
    <span style="margin-top: 0.5rem; display: inline-block;">Built with ‚úä by Secret Weapon Group</span>
    <br>
    <a href="/badges.html" style="margin-top: 0.5rem; display: inline-block;">
      <img src="/badges/spite-inside.svg" alt="Spite Inside" width="150" height="70" style="vertical-align: middle;">
    </a>
  </footer>

  <script>
    const BADGE_INFO = {
      'speed-run': { emoji: 'üèÉ', name: 'Speed Run - First commit to production < 24 hours' },
      'one-coffee': { emoji: '‚òï', name: 'One Coffee Build - Built during a single coffee session' },
      'rage-quit': { emoji: 'üí¢', name: 'Rage Quit Result - Built immediately after rage-quitting something' },
      '3am-spite': { emoji: 'üåô', name: '3am Spite - Primary commits between 2-5am' },
      'full-circle': { emoji: 'üîÑ', name: 'Full Circle - Replaced something that replaced something you built' },
      'surgical-strike': { emoji: 'üéØ', name: 'Surgical Strike - Under 100 lines of code' },
      'mammoth-slayer': { emoji: 'ü¶£', name: 'Mammoth Slayer - Replaced enterprise software' },
      'vibe-coded': { emoji: 'üé®', name: 'Vibe Coded - Built primarily with AI assistance' },
      'subscription-killer': { emoji: 'üí∏', name: 'Subscription Killer - Replaces a paid SaaS' },
      'first-blood': { emoji: 'üè¥', name: 'First Blood - One of the first 100 spite projects listed' },
    };

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    function renderProject(p) {
      const links = [];
      if (p.repo) links.push(`<a href="${escapeHtml(p.repo)}" target="_blank" rel="noopener noreferrer">Repo</a>`);
      if (p.web) links.push(`<a href="${escapeHtml(p.web)}" target="_blank" rel="noopener noreferrer">Website</a>`);
      if (p.app?.android) links.push(`<a href="${escapeHtml(p.app.android)}" target="_blank" rel="noopener noreferrer">Android</a>`);
      if (p.app?.ios) links.push(`<a href="${escapeHtml(p.app.ios)}" target="_blank" rel="noopener noreferrer">iOS</a>`);

      const labels = (p.labels || []).slice(0, 3).map(l =>
        `<a href="/?label=${encodeURIComponent(l)}" class="label">${escapeHtml(l)}</a>`
      ).join('');

      const badges = (p.badges || []).map(badgeId => {
        const badge = BADGE_INFO[badgeId];
        if (!badge) return '';
        return `<span class="badge" title="${escapeHtml(badge.name)}">${badge.emoji}</span>`;
      }).join('');

      const thumbHtml = p.thumbnail
        ? `<img src="${escapeHtml(p.thumbnail)}" alt="" class="project-thumb" loading="lazy">`
        : '';

      const projectId = encodeURIComponent(p.name);

      return `
        <div class="project-card ${p.thumbnail ? '' : 'no-thumb'}" data-project-id="${projectId}">
          ${thumbHtml}
          <div class="project-info">
            <div class="project-header">
              <h3>${escapeHtml(p.name)}</h3>
              ${badges ? `<div class="badges">${badges}</div>` : ''}
            </div>
            <p class="description">${escapeHtml(p.description)}</p>
            <div class="project-meta">
              <span>by ${escapeHtml(p.author || 'anonymous')}</span>
            </div>
            <div class="labels">${labels}</div>
            <div class="project-links">
              ${links.join('')}
              <a href="#" class="pricing-toggle" data-project-id="${projectId}">Enterprise Pricing</a>
            </div>
          </div>
          <div class="pricing-section" id="pricing-${projectId}" style="display: none;">
            <div class="pricing-loading">Loading enterprise pricing...</div>
          </div>
        </div>
      `;
    }

    async function loadProjects() {
      const container = document.getElementById('projects');
      try {
        const res = await fetch('/api/projects');
        const projects = await res.json();

        if (projects.length === 0) {
          container.innerHTML = '<p style="color: #666;">No projects yet. Be the first to submit!</p>';
          return;
        }

        container.innerHTML = projects.map(renderProject).join('');
      } catch (err) {
        container.innerHTML = '<p style="color: #ff6b6b;">Failed to load projects</p>';
      }
    }

    // Search filter
    document.getElementById('search').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      document.querySelectorAll('.project-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(query) ? '' : 'none';
      });
    });

    // Pricing toggle handler
    async function togglePricing(projectId) {
      const pricingSection = document.getElementById(`pricing-${projectId}`);

      if (pricingSection.style.display === 'none') {
        pricingSection.style.display = 'block';

        // Load pricing if not already loaded
        if (pricingSection.querySelector('.pricing-loading')) {
          try {
            const res = await fetch(`/api/projects/${projectId}/pricing`);
            const data = await res.json();
            pricingSection.innerHTML = renderPricing(data);
          } catch (err) {
            pricingSection.innerHTML = '<p style="color: #ff6b6b; padding: 1rem;">Failed to load pricing</p>';
          }
        }
      } else {
        pricingSection.style.display = 'none';
      }
    }

    function renderPricing(data) {
      const tiersHtml = data.tiers.map(tier => {
        const totalPrice = tier.lineItems?.reduce((sum, item) => sum + item.price, 0) || 0;
        const lineItemsHtml = tier.lineItems?.map(item =>
          `<li>${escapeHtml(item.name)}: $${item.price.toLocaleString()}</li>`
        ).join('') || '';

        const featuresHtml = tier.features.map(f => `<li>${escapeHtml(f)}</li>`).join('');

        const metaHtml = tier.meetings || tier.timeline ? `
          <div class="tier-meta">
            ${tier.meetings ? `<div>Required Meetings: <strong>${tier.meetings}</strong></div>` : ''}
            ${tier.timeline ? `<div>Implementation: <strong>${escapeHtml(tier.timeline)}</strong></div>` : ''}
          </div>
        ` : '';

        const badge = tier.highlighted ? '<div class="most-popular-badge">MOST POPULAR</div>' : '';

        return `
          <div class="pricing-tier ${tier.highlighted ? 'highlighted' : ''}">
            ${badge}
            <h4>${escapeHtml(tier.name)}</h4>
            <div class="tier-price">${escapeHtml(tier.price)}</div>
            <p class="tier-description">${escapeHtml(tier.description)}</p>
            ${lineItemsHtml ? `<ul class="line-items">${lineItemsHtml}</ul>` : ''}
            ${totalPrice > 0 ? `<div class="tier-total">Total: $${totalPrice.toLocaleString()}/year</div>` : ''}
            <ul class="tier-features">${featuresHtml}</ul>
            ${metaHtml}
          </div>
        `;
      }).join('');

      return `
        <div class="pricing-header">
          <h3>Enterprise Pricing Options</h3>
          <div class="pricing-disclaimer">${escapeHtml(data.disclaimer)}</div>
        </div>
        <div class="pricing-grid">
          ${tiersHtml}
        </div>
        <div class="pricing-footer">
          <button class="demo-button">Schedule a Demo</button>
        </div>
      `;
    }

    // Event delegation for pricing toggles and demo buttons
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('pricing-toggle')) {
        e.preventDefault();
        const projectId = e.target.dataset.projectId;
        togglePricing(projectId);
      }

      if (e.target.classList.contains('demo-button')) {
        alert("Just use the free version. It's right there. ‚úä");
      }
    });

    loadProjects();
  </script>
</body>
</html>
